generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Admin {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  username     String @unique
  passwordHash String
}

model Customer {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  snapchat String  @unique
  username String?

  personalCode   String? @unique
  referralCode   String? @unique
  referredByCode String?

  passwordHash String?

  orders  Order[]
  invites Invite[]
}

model Invite {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  code String  @unique
  used Boolean @default(false)

  expiresAt DateTime

  customerId String?
  customer   Customer? @relation(fields: [customerId], references: [id])

  @@index([expiresAt])
  @@index([used])
}

model Product {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String  @unique
  description String?
  priceCents  Int
  isActive    Boolean @default(true)

  stockQty Int @default(0)

  category String

  orderItems OrderItem[]
}

model Order {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  snapchat     String
  municipality String
  deliveryDay  String

  // âœ… DEFAULT toegevoegd zodat db push geen reset meer nodig heeft
  deliveryStartMinutes Int @default(0)

  note String?

  totalCents  Int     @default(0)
  isCompleted Boolean @default(false)

  customerId String?
  customer   Customer? @relation(fields: [customerId], references: [id])

  deliveryStopId String?
  deliveryStop   DeliveryStop? @relation(fields: [deliveryStopId], references: [id])

  items OrderItem[]

  @@index([municipality])
  @@index([deliveryDay])
  @@index([deliveryStartMinutes])
  @@index([isCompleted])
  @@index([createdAt])
}

model OrderItem {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orderId   String
  productId String

  quantity   Int
  priceCents Int

  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])

  @@unique([orderId, productId])
  @@index([orderId])
  @@index([productId])
}

model TravelTime {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  fromMunicipality String
  toMunicipality   String
  minutes          Int

  @@unique([fromMunicipality, toMunicipality])
  @@index([fromMunicipality])
  @@index([toMunicipality])
}

model DeliveryStop {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  deliveryDay  String
  startMinutes Int
  municipality String

  capacityMax  Int @default(3)
  capacityUsed Int @default(0)

  orders Order[]

  @@unique([deliveryDay, municipality, startMinutes])
  @@index([deliveryDay])
  @@index([startMinutes])
  @@index([municipality])
}
